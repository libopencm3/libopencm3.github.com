<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.4"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>libopencm3: Cortex Core Atomic support Defines</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">libopencm3
   </div>
   <div id="projectbrief">A free/libre/open-source firmware library for various ARM Cortex-M3 microcontrollers.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.4 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search",'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('group__CM3__cortex__atomic__defines.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#define-members">Macros</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle"><div class="title">Cortex Core Atomic support Defines<div class="ingroups"><a class="el" href="group__CM3__defines.html">CM3 Defines</a> &raquo; <a class="el" href="group__CM3__cortex__defines.html">Cortex Core Defines</a></div></div></div>
</div><!--header-->
<div class="contents">

<p>Atomic operation support.  
<a href="#details">More...</a></p>
<div class="dynheader">
Collaboration diagram for Cortex Core Atomic support Defines:</div>
<div class="dyncontent">
<div class="center"><img src="group__CM3__cortex__atomic__defines.png" border="0" usemap="#agroup____CM3____cortex____atomic____defines" alt=""/></div>
<map name="agroup____CM3____cortex____atomic____defines" id="agroup____CM3____cortex____atomic____defines">
<area shape="rect" title="Atomic operation support." alt="" coords="205,5,355,45"/>
<area shape="rect" href="group__CM3__cortex__defines.html" title="libopencm3 Defined Constants and Types for the Cortex Core" alt="" coords="5,13,157,38"/>
</map>
</div>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="define-members" name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:ga03ee33aa307c41ceb35288a40539ecbc"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__CM3__cortex__atomic__defines.html#ga03ee33aa307c41ceb35288a40539ecbc">__CM_SAVER</a>(state)</td></tr>
<tr class="separator:ga03ee33aa307c41ceb35288a40539ecbc"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga6904952be4c789ef4957c8c9bce83fc6"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__CM3__cortex__atomic__defines.html#ga6904952be4c789ef4957c8c9bce83fc6">CM_ATOMIC_BLOCK</a>()&#160;&#160;&#160;	for (uint32_t <a class="el" href="group__CM3__cortex__atomic__defines.html#ga03ee33aa307c41ceb35288a40539ecbc">__CM_SAVER</a>(true), __my = true; __my; __my = false)</td></tr>
<tr class="memdesc:ga6904952be4c789ef4957c8c9bce83fc6"><td class="mdescLeft">&#160;</td><td class="mdescRight">Cortex M Atomic Declare block.  <a href="group__CM3__cortex__atomic__defines.html#ga6904952be4c789ef4957c8c9bce83fc6">More...</a><br /></td></tr>
<tr class="separator:ga6904952be4c789ef4957c8c9bce83fc6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gabd996a426e72e63e0d4d100d3dd6ff87"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__CM3__cortex__atomic__defines.html#gabd996a426e72e63e0d4d100d3dd6ff87">CM_ATOMIC_CONTEXT</a>()&#160;&#160;&#160;uint32_t <a class="el" href="group__CM3__cortex__atomic__defines.html#ga03ee33aa307c41ceb35288a40539ecbc">__CM_SAVER</a>(true)</td></tr>
<tr class="memdesc:gabd996a426e72e63e0d4d100d3dd6ff87"><td class="mdescLeft">&#160;</td><td class="mdescRight">Cortex M Atomic Declare context.  <a href="group__CM3__cortex__atomic__defines.html#gabd996a426e72e63e0d4d100d3dd6ff87">More...</a><br /></td></tr>
<tr class="separator:gabd996a426e72e63e0d4d100d3dd6ff87"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="func-members" name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:ga63d8cc4da4cf40652535e8af71a5675b"><td class="memItemLeft" align="right" valign="top">static uint32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__CM3__cortex__atomic__defines.html#ga63d8cc4da4cf40652535e8af71a5675b">__cm_atomic_set</a> (uint32_t *val)</td></tr>
<tr class="separator:ga63d8cc4da4cf40652535e8af71a5675b"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<p >Atomic operation support. </p>
<h2 class="groupheader">Macro Definition Documentation</h2>
<a id="ga03ee33aa307c41ceb35288a40539ecbc" name="ga03ee33aa307c41ceb35288a40539ecbc"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga03ee33aa307c41ceb35288a40539ecbc">&#9670;&nbsp;</a></span>__CM_SAVER</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define __CM_SAVER</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">state</td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<b>Value:</b><div class="fragment"><div class="line">        __val = (state),                                        \</div>
<div class="line">        __save __attribute__((__cleanup__(<a class="code hl_function" href="group__CM3__cortex__atomic__defines.html#ga63d8cc4da4cf40652535e8af71a5675b">__cm_atomic_set</a>))) =  \</div>
<div class="line">        <a class="code hl_function" href="group__CM3__cortex__atomic__defines.html#ga63d8cc4da4cf40652535e8af71a5675b">__cm_atomic_set</a>(&amp;__val)</div>
<div class="ttc" id="agroup__CM3__cortex__atomic__defines_html_ga63d8cc4da4cf40652535e8af71a5675b"><div class="ttname"><a href="group__CM3__cortex__atomic__defines.html#ga63d8cc4da4cf40652535e8af71a5675b">__cm_atomic_set</a></div><div class="ttdeci">static uint32_t __cm_atomic_set(uint32_t *val)</div><div class="ttdef"><b>Definition:</b> <a href="cortex_8h_source.html#l00166">cortex.h:166</a></div></div>
</div><!-- fragment -->
<p class="definition">Definition at line <a class="el" href="cortex_8h_source.html#l00171">171</a> of file <a class="el" href="cortex_8h_source.html">cortex.h</a>.</p>

</div>
</div>
<a id="ga6904952be4c789ef4957c8c9bce83fc6" name="ga6904952be4c789ef4957c8c9bce83fc6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga6904952be4c789ef4957c8c9bce83fc6">&#9670;&nbsp;</a></span>CM_ATOMIC_BLOCK</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define CM_ATOMIC_BLOCK</td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td>&#160;&#160;&#160;	for (uint32_t <a class="el" href="group__CM3__cortex__atomic__defines.html#ga03ee33aa307c41ceb35288a40539ecbc">__CM_SAVER</a>(true), __my = true; __my; __my = false)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Cortex M Atomic Declare block. </p>
<p >This macro disables interrupts for the next command or block of code. The interrupt mask is automatically restored after exit of the boundary of the code block. Therefore restore of interrupt is done automatically after call of return or goto control sentence jumping outside of the block.</p>
<dl class="section warning"><dt>Warning</dt><dd>The usage of sentences break or continue is prohibited in the block due to implementation of this macro!</dd></dl>
<dl class="section note"><dt>Note</dt><dd>It is safe to use this block inside normal code and in interrupt routine.</dd></dl>
<p>Basic usage of atomic block</p>
<div class="fragment"><div class="line">uint64_t value;         <span class="comment">// This value is used somewhere in interrupt</span></div>
<div class="line"> </div>
<div class="line">...</div>
<div class="line"> </div>
<div class="line">CM_ATOMIC_BLOCK() {                     <span class="comment">// interrupts are masked in this block</span></div>
<div class="line">    value = value * 1024 + 651; <span class="comment">// access value as atomic</span></div>
<div class="line">}                                       <span class="comment">// interrupts is restored automatically</span></div>
</div><!-- fragment --><p >Use of return inside block</p>
<div class="fragment"><div class="line">uint64_t value;         <span class="comment">// This value is used somewhere in interrupt</span></div>
<div class="line"> </div>
<div class="line">...</div>
<div class="line"> </div>
<div class="line">uint64_t allocval(<span class="keywordtype">void</span>)</div>
<div class="line">{</div>
<div class="line">    <a class="code hl_define" href="group__CM3__cortex__atomic__defines.html#ga6904952be4c789ef4957c8c9bce83fc6">CM_ATOMIC_BLOCK</a>() {         <span class="comment">// interrupts are masked in this block</span></div>
<div class="line">        value = value * 1024 + 651;     <span class="comment">// do long atomic operation</span></div>
<div class="line">        <span class="keywordflow">return</span> value;           <span class="comment">// interrupts is restored automatically</span></div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="ttc" id="agroup__CM3__cortex__atomic__defines_html_ga6904952be4c789ef4957c8c9bce83fc6"><div class="ttname"><a href="group__CM3__cortex__atomic__defines.html#ga6904952be4c789ef4957c8c9bce83fc6">CM_ATOMIC_BLOCK</a></div><div class="ttdeci">#define CM_ATOMIC_BLOCK()</div><div class="ttdoc">Cortex M Atomic Declare block.</div><div class="ttdef"><b>Definition:</b> <a href="cortex_8h_source.html#l00224">cortex.h:224</a></div></div>
</div><!-- fragment --> 
<p class="definition">Definition at line <a class="el" href="cortex_8h_source.html#l00224">224</a> of file <a class="el" href="cortex_8h_source.html">cortex.h</a>.</p>

</div>
</div>
<a id="gabd996a426e72e63e0d4d100d3dd6ff87" name="gabd996a426e72e63e0d4d100d3dd6ff87"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gabd996a426e72e63e0d4d100d3dd6ff87">&#9670;&nbsp;</a></span>CM_ATOMIC_CONTEXT</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define CM_ATOMIC_CONTEXT</td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td>&#160;&#160;&#160;uint32_t <a class="el" href="group__CM3__cortex__atomic__defines.html#ga03ee33aa307c41ceb35288a40539ecbc">__CM_SAVER</a>(true)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Cortex M Atomic Declare context. </p>
<p >This macro disables interrupts in the current block of code from the place where it is defined to the end of the block. The interrupt mask is automatically restored after exit of the boundary of the code block. Therefore restore of interrupt is done automatically after call of return, continue, break, or goto control sentence jumping outside of the block.</p>
<dl class="section note"><dt>Note</dt><dd>This function is intended for use in for- cycles to enable the use of break and contine sentences inside the block, and for securing the atomic reader-like functions.</dd>
<dd>
It is safe to use this block inside normal code and in interrupt routine.</dd></dl>
<p>Basic usage of atomic context</p>
<div class="fragment"><div class="line">uint64_t value;         <span class="comment">// This value is used somewhere in interrupt</span></div>
<div class="line"> </div>
<div class="line">...</div>
<div class="line"> </div>
<div class="line">for (<span class="keywordtype">int</span> i=0;i &lt; 100; i++) {</div>
<div class="line">    <a class="code hl_define" href="group__CM3__cortex__atomic__defines.html#gabd996a426e72e63e0d4d100d3dd6ff87">CM_ATOMIC_CONTEXT</a>();                <span class="comment">// interrupts are masked in this block</span></div>
<div class="line">    value += 100;                       <span class="comment">// access value as atomic</span></div>
<div class="line">    <span class="keywordflow">if</span> ((value % 16) == 0) {</div>
<div class="line">        <span class="keywordflow">break</span>;                  <span class="comment">// restore interrupts and break cycle</span></div>
<div class="line">    }</div>
<div class="line">}                                       <span class="comment">// interrupts is restored automatically</span></div>
<div class="ttc" id="agroup__CM3__cortex__atomic__defines_html_gabd996a426e72e63e0d4d100d3dd6ff87"><div class="ttname"><a href="group__CM3__cortex__atomic__defines.html#gabd996a426e72e63e0d4d100d3dd6ff87">CM_ATOMIC_CONTEXT</a></div><div class="ttdeci">#define CM_ATOMIC_CONTEXT()</div><div class="ttdoc">Cortex M Atomic Declare context.</div><div class="ttdef"><b>Definition:</b> <a href="cortex_8h_source.html#l00278">cortex.h:278</a></div></div>
</div><!-- fragment --><p >Usage of atomic context inside atomic reader fcn.</p>
<div class="fragment"><div class="line">uint64_t value;         <span class="comment">// This value is used somewhere in interrupt</span></div>
<div class="line"> </div>
<div class="line">...</div>
<div class="line"> </div>
<div class="line">uint64_t getnextval(<span class="keywordtype">void</span>)</div>
<div class="line">{</div>
<div class="line">    <a class="code hl_define" href="group__CM3__cortex__atomic__defines.html#gabd996a426e72e63e0d4d100d3dd6ff87">CM_ATOMIC_CONTEXT</a>();        <span class="comment">// interrupts are masked in this block</span></div>
<div class="line">    value = value + 3;  <span class="comment">// do long atomic operation</span></div>
<div class="line">    <span class="keywordflow">return</span> value;               <span class="comment">// interrupts is restored automatically</span></div>
<div class="line">}</div>
</div><!-- fragment --> 
<p class="definition">Definition at line <a class="el" href="cortex_8h_source.html#l00278">278</a> of file <a class="el" href="cortex_8h_source.html">cortex.h</a>.</p>

</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a id="ga63d8cc4da4cf40652535e8af71a5675b" name="ga63d8cc4da4cf40652535e8af71a5675b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga63d8cc4da4cf40652535e8af71a5675b">&#9670;&nbsp;</a></span>__cm_atomic_set()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static uint32_t __cm_atomic_set </td>
          <td>(</td>
          <td class="paramtype">uint32_t *&#160;</td>
          <td class="paramname"><em>val</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="cortex_8h_source.html#l00166">166</a> of file <a class="el" href="cortex_8h_source.html">cortex.h</a>.</p>

<p class="reference">References <a class="el" href="cortex_8h_source.html#l00122">cm_mask_interrupts()</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="group__CM3__cortex__atomic__defines_ga63d8cc4da4cf40652535e8af71a5675b_cgraph.png" border="0" usemap="#agroup__CM3__cortex__atomic__defines_ga63d8cc4da4cf40652535e8af71a5675b_cgraph" alt=""/></div>
<map name="agroup__CM3__cortex__atomic__defines_ga63d8cc4da4cf40652535e8af71a5675b_cgraph" id="agroup__CM3__cortex__atomic__defines_ga63d8cc4da4cf40652535e8af71a5675b_cgraph">
<area shape="rect" title=" " alt="" coords="5,5,140,32"/>
<area shape="rect" href="group__CM3__cortex__defines.html#gaf18d826285fad19472b328742eae6c6b" title="Cortex M Mask interrupts." alt="" coords="188,5,343,32"/>
</map>
</div>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Tue Mar 7 2023 16:13:10 for libopencm3 by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.4 </li>
  </ul>
</div>
</body>
</html>
